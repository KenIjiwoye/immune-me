# FE-07: Implement Notifications Management System

## Context
The Immunization Records Management System requires a comprehensive notifications management system to handle immunization due dates and alerts. While the dashboard (FE-02) displays a preview of recent notifications, users need a dedicated interface to view, manage, and filter all notifications generated by the notification service (BE-06).

## Dependencies
- FE-01: Authentication flow implemented
- FE-02: Dashboard screen with notification preview
- BE-06: Notification service with API endpoints
- BE-05: API endpoints for notifications

## Requirements
1. Create a notifications directory with proper navigation structure
2. Implement notifications list screen with filtering capabilities
3. Create notification details screen for viewing full information
4. Add functionality to mark notifications as viewed/completed
5. Implement filtering by status (pending, viewed, completed, overdue)
6. Ensure responsive design for mobile devices
7. Integrate with existing dashboard navigation

## API Endpoints Available
- `GET /api/notifications` - List all notifications with pagination
- `GET /api/notifications/due` - Get due notifications
- `GET /api/notifications/:id` - Get notification details
- `PUT /api/notifications/:id` - Update notification status

## Code Examples

### Notifications List Screen

```typescript
// frontend/app/notifications/index.tsx
import React, { useEffect, useState } from 'react';
import { View, Text, StyleSheet, FlatList, TouchableOpacity, ActivityIndicator, RefreshControl } from 'react-native';
import { useAuth } from '../../context/auth';
import { router } from 'expo-router';
import { Ionicons } from '@expo/vector-icons';
import api from '../../services/api';
import NotificationCard from '../components/NotificationCard';

type Notification = {
  id: number;
  patientName: string;
  vaccineName: string;
  dueDate: string;
  status: 'pending' | 'viewed' | 'completed' | 'overdue';
  patientId: number;
  vaccineId: number;
};

export default function NotificationsScreen() {
  const { user } = useAuth();
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [refreshing, setRefreshing] = useState(false);

  const loadNotifications = async () => {
    try {
      setIsLoading(true);
      const response = await api.get('/notifications/due');
      setNotifications(response.data);
    } catch (error) {
      console.error('Failed to load notifications:', error);
    } finally {
      setIsLoading(false);
    }
  };

  useEffect(() => {
    loadNotifications();
  }, []);

  const handleRefresh = () => {
    setRefreshing(true);
    loadNotifications().finally(() => setRefreshing(false));
  };

  const renderNotification = ({ item }: { item: Notification }) => (
    <NotificationCard
      notification={item}
      onPress={() => router.push(`/notifications/${item.id}`)}
    />
  );

  if (isLoading) {
    return (
      <View style={styles.loadingContainer}>
        <ActivityIndicator size="large" color="#007bff" />
        <Text style={styles.loadingText}>Loading notifications...</Text>
      </View>
    );
  }

  return (
    <FlatList
      data={notifications}
      renderItem={renderNotification}
      keyExtractor={(item) => item.id.toString()}
      contentContainerStyle={styles.container}
      refreshControl={
        <RefreshControl refreshing={refreshing} onRefresh={handleRefresh} />
      }
      ListEmptyComponent={
        <View style={styles.emptyContainer}>
          <Ionicons name="notifications-off-outline" size={64} color="#6c757d" />
          <Text style={styles.emptyText}>No notifications found</Text>
        </View>
      }
    />
  );
}

const styles = StyleSheet.create({
  container: {
    padding: 16,
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  loadingText: {
    marginTop: 16,
    fontSize: 16,
    color: '#6c757d',
  },
  emptyContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    padding: 32,
  },
  emptyText: {
    marginTop: 16,
    fontSize: 16,
    color: '#6c757d',
  },
});
```

### Notification Details Screen

```typescript
// frontend/app/notifications/[id].tsx
import React, { useEffect, useState } from 'react';
import { View, Text, StyleSheet, ScrollView, TouchableOpacity, ActivityIndicator } from 'react-native';
import { useAuth } from '../../context/auth';
import { router, useLocalSearchParams } from 'expo-router';
import { Ionicons } from '@expo/vector-icons';
import api from '../../services/api';
import { format } from 'date-fns';

type NotificationDetail = {
  id: number;
  patient: {
    id: number;
    fullName: string;
    dateOfBirth: string;
    cardNumber: string;
  };
  vaccine: {
    id: number;
    name: string;
    description: string;
  };
  dueDate: string;
  status: 'pending' | 'viewed' | 'completed' | 'overdue';
  createdAt: string;
};

export default function NotificationDetailScreen() {
  const { id } = useLocalSearchParams();
  const { user } = useAuth();
  const [notification, setNotification] = useState<NotificationDetail | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  const loadNotification = async () => {
    try {
      setIsLoading(true);
      const response = await api.get(`/notifications/${id}`);
      setNotification(response.data);
    } catch (error) {
      console.error('Failed to load notification:', error);
    } finally {
      setIsLoading(false);
    }
  };

  useEffect(() => {
    loadNotification();
  }, [id]);

  const handleUpdateStatus = async (status: 'viewed' | 'completed') => {
    try {
      await api.put(`/notifications/${notification?.id}`, { status });
      setNotification(prev => prev ? { ...prev, status } : null);
    } catch (error) {
      console.error('Failed to update notification:', error);
    }
  };

  const handleViewPatient = () => {
    if (notification) {
      router.push(`/patients/${notification.patient.id}`);
    }
  };

  if (isLoading) {
    return (
      <View style={styles.loadingContainer}>
        <ActivityIndicator size="large" color="#007bff" />
        <Text style={styles.loadingText}>Loading notification details...</Text>
      </View>
    );
  }

  if (!notification) {
    return (
      <View style={styles.errorContainer}>
        <Ionicons name="alert-circle-outline" size={64} color="#dc3545" />
        <Text style={styles.errorText}>Notification not found</Text>
      </View>
    );
  }

  const formattedDueDate = format(new Date(notification.dueDate), 'MMMM d, yyyy');
  const formattedCreatedAt = format(new Date(notification.createdAt), 'MMMM d, yyyy');

  return (
    <ScrollView style={styles.container}>
      <View style={styles.header}>
        <TouchableOpacity onPress={() => router.back()}>
          <Ionicons name="arrow-back" size={24} color="#007bff" />
        </TouchableOpacity>
        <Text style={styles.headerTitle}>Notification Details</Text>
      </View>

      <View style={styles.card}>
        <View style={styles.statusContainer}>
          <View style={[styles.statusBadge, { backgroundColor: getStatusColor(notification.status) + '20' }]}>
            <Text style={[styles.statusText, { color: getStatusColor(notification.status) }]}>
              {notification.status.charAt(0).toUpperCase() + notification.status.slice(1)}
            </Text>
          </View>
        </View>

        <View style={styles.section}>
          <Text style={styles.sectionTitle}>Patient Information</Text>
          <Text style={styles.patientName}>{notification.patient.fullName}</Text>
          <Text style={styles.patientDetail}>Card: {notification.patient.cardNumber}</Text>
          <Text style={styles.patientDetail}>
            DOB: {format(new Date(notification.patient.dateOfBirth), 'MMMM d, yyyy')}
          </Text>
        </View>

        <View style={styles.section}>
          <Text style={styles.sectionTitle}>Vaccine Information</Text>
          <Text style={styles.vaccineName}>{notification.vaccine.name}</Text>
          <Text style={styles.vaccineDescription}>{notification.vaccine.description}</Text>
        </View>

        <View style={styles.section}>
          <Text style={styles.sectionTitle}>Schedule Details</Text>
          <View style={styles.detailRow}>
            <Ionicons name="calendar-outline" size={20} color="#6c757d" />
            <View style={styles.detailText}>
              <Text style={styles.detailLabel}>Due Date</Text>
              <Text style={styles.detailValue}>{formattedDueDate}</Text>
            </View>
          </View>
          <View style={styles.detailRow}>
            <Ionicons name="time-outline" size={20} color="#6c757d" />
            <View style={styles.detailText}>
              <Text style={styles.detailLabel}>Created</Text>
              <Text style={styles.detailValue}>{formattedCreatedAt}</Text>
            </View>
          </View>
        </View>

        <View style={styles.actions}>
          {notification.status === 'pending' && (
            <>
              <TouchableOpacity
                style={[styles.button, styles.viewButton]}
                onPress={() => handleUpdateStatus('viewed')}
              >
                <Ionicons name="eye-outline" size={20} color="#007bff" />
                <Text style={styles.buttonText}>Mark as Viewed</Text>
              </TouchableOpacity>
              <TouchableOpacity
                style={[styles.button, styles.completeButton]}
                onPress={() => handleUpdateStatus('completed')}
              >
                <Ionicons name="checkmark-circle-outline" size={20} color="#fff" />
                <Text style={[styles.buttonText, styles.completeButtonText]}>Mark as Completed</Text>
              </TouchableOpacity>
            </>
          )}
          {notification.status === 'viewed' && (
            <TouchableOpacity
              style={[styles.button, styles.completeButton]}
              onPress={() => handleUpdateStatus('completed')}
            >
              <Ionicons name="checkmark-circle-outline" size={20} color="#fff" />
              <Text style={[styles.buttonText, styles.completeButtonText]}>Mark as Completed</Text>
            </TouchableOpacity>
          )}
        </View>

        <TouchableOpacity
          style={styles.patientButton}
          onPress={handleViewPatient}
        >
          <Ionicons name="person-outline" size={20} color="#007bff" />
          <Text style={styles.patientButtonText}>View Patient Details</Text>
        </TouchableOpacity>
      </View>
    </ScrollView>
  );
}

const getStatusColor = (status: string) => {
  switch (status) {
    case 'pending': return '#FF9800';
    case 'viewed': return '#2196F3';
    case 'completed': return '#4CAF50';
    case 'overdue': return '#F44336';
    default: return '#6c757d';
  }
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#f8f9fa',
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  loadingText: {
    marginTop: 16,
    fontSize: 16,
    color: '#6c757d',
  },
  errorContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  errorText: {
    marginTop: 16,
    fontSize: 16,
    color: '#dc3545',
  },
  header: {
    flexDirection: 'row',
    alignItems: 'center',
    padding: 16,
    backgroundColor: '#fff',
    borderBottomWidth: 1,
    borderBottomColor: '#e9ecef',
  },
  headerTitle: {
    fontSize: 18,
    fontWeight: 'bold',
    marginLeft: 16,
  },
  card: {
    backgroundColor: '#fff',
    margin: 16,
    borderRadius: 8,
    padding: 20,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 3,
  },
  statusContainer: {
    alignItems: 'center',
    marginBottom: 20,
  },
  statusBadge: {
    paddingHorizontal: 16,
    paddingVertical: 8,
    borderRadius: 20,
  },
  statusText: {
    fontSize: 14,
    fontWeight: 'bold',
  },
  section: {
    marginBottom: 20,
  },
  sectionTitle: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#6c757d',
    marginBottom: 8,
  },
  patientName: {
    fontSize: 20,
    fontWeight: 'bold',
    marginBottom: 4,
  },
  patientDetail: {
    fontSize: 14,
    color: '#6c757d',
    marginBottom: 2,
  },
  vaccineName: {
    fontSize: 18,
    fontWeight: 'bold',
    marginBottom: 4,
  },
  vaccineDescription: {
    fontSize: 14,
    color: '#6c757d',
  },
  detailRow: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 12,
  },
  detailText: {
    marginLeft: 12,
  },
  detailLabel: {
    fontSize: 12,
    color: '#6c757d',
  },
  detailValue: {
    fontSize: 16,
    fontWeight: 'bold',
  },
  actions: {
    flexDirection: 'row',
    gap: 12,
    marginBottom: 16,
  },
  button: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'center',
    padding: 12,
    borderRadius: 8,
    flex: 1,
  },
  viewButton: {
    backgroundColor: '#e3f2fd',
    borderWidth: 1,
    borderColor: '#007bff',
  },
  completeButton: {
    backgroundColor: '#007bff',
  },
  buttonText: {
    marginLeft: 8,
    fontSize: 14,
    fontWeight: 'bold',
  },
  completeButtonText: {
    color: '#fff',
  },
  patientButton: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'center',
    padding: 12,
    borderWidth: 1,
    borderColor: '#007bff',
    borderRadius: 8,
  },
  patientButtonText: {
    marginLeft: 8,
    fontSize: 14,
    color: '#007bff',
    fontWeight: 'bold',
  },
});
```

### Notifications Layout

```typescript
// frontend/app/notifications/_layout.tsx
import React from 'react';
import { Stack } from 'expo-router';

export default function NotificationsLayout() {
  return (
    <Stack>
      <Stack.Screen
        name="index"
        options={{
          headerTitle: 'Notifications',
          headerShown: false,
        }}
      />
      <Stack.Screen
        name="[id]"
        options={{
          headerTitle: 'Notification Details',
        }}
      />
    </Stack>
  );
}
```

### Enhanced Notification Card Component

```typescript
// frontend/app/components/EnhancedNotificationCard.tsx
import React from 'react';
import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { format } from 'date-fns';

type EnhancedNotificationCardProps = {
  notification: {
    id: number;
    patientName: string;
    vaccineName: string;
    dueDate: string;
    status: 'pending' | 'viewed' | 'completed' | 'overdue';
  };
  onPress?: () => void;
  onMarkCompleted?: () => void;
  onMarkViewed?: () => void;
  showActions?: boolean;
};

export default function EnhancedNotificationCard({
  notification,
  onPress,
  onMarkCompleted,
  onMarkViewed,
  showActions = false,
}: EnhancedNotificationCardProps) {
  const getStatusColor = (status: string) => {
    switch (status) {
      case 'pending': return '#FF9800';
      case 'viewed': return '#2196F3';
      case 'completed': return '#4CAF50';
      case 'overdue': return '#F44336';
      default: return '#6c757d';
    }
  };

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'pending': return 'time-outline';
      case 'viewed': return 'eye-outline';
      case 'completed': return 'checkmark-circle-outline';
      case 'overdue': return 'alert-circle-outline';
      default: return 'help-circle-outline';
    }
  };

  const formattedDate = format(new Date(notification.dueDate), 'MMM d, yyyy');
  const statusColor = getStatusColor(notification.status);
  const statusIcon = getStatusIcon(notification.status);

  return (
    <TouchableOpacity style={styles.card} onPress={onPress}>
      <View style={styles.content}>
        <View style={styles.header}>
          <Text style={styles.patientName}>{notification.patientName}</Text>
          <View style={[styles.statusBadge, { backgroundColor: `${statusColor}20` }]}>
            <Ionicons name={statusIcon as any} size={14} color={statusColor} />
            <Text style={[styles.statusText, { color: statusColor }]}>
              {notification.status.charAt(0).toUpperCase() + notification.status.slice(1)}
            </Text>
          </View>
        </View>
        
        <Text style={styles.vaccineName}>{notification.vaccineName}</Text>
        
        <View style={styles.footer}>
          <View style={styles.dateContainer}>
            <Ionicons name="calendar-outline" size={14} color="#6c757d" />
            <Text style={styles.date}>{formattedDate}</Text>
          </View>
        </View>

        {showActions && (
          <View style={styles.actions}>
            {notification.status === 'pending' && (
              <>
                <TouchableOpacity
                  style={[styles.actionButton, styles.viewButton]}
                  onPress={onMarkViewed}
                >
                  <Ionicons name="eye-outline" size={16} color="#007bff" />
                  <Text style={styles.actionText}>View</Text>
                </TouchableOpacity>
                <TouchableOpacity
                  style={[styles.actionButton, styles.completeButton]}
                  onPress={onMarkCompleted}
                >
                  <Ionicons name="checkmark-circle-outline" size={16} color="#fff" />
                  <Text style={[styles.actionText, styles.completeText]}>Complete</Text>
                </TouchableOpacity>
              </>
            )}
            {notification.status === 'viewed' && (
              <TouchableOpacity
                style={[styles.actionButton, styles.completeButton]}
                onPress={onMarkCompleted}
              >
                <Ionicons name="checkmark-circle-outline" size={16} color="#fff" />
                <Text style={[styles.actionText, styles.completeText]}>Complete</Text>
              </TouchableOpacity>
            )}
          </View>
        )}
      </View>
      
      <Ionicons name="chevron-forward" size={20} color="#6c757d" />
    </TouchableOpacity>
  );
}

const styles = StyleSheet.create({
  card: {
    backgroundColor: '#fff',
    borderRadius: 8,
    padding: 16,
    marginBottom: 12,
    flexDirection: 'row',
    alignItems: 'center',
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 1 },
    shadowOpacity: 0.1,
    shadowRadius: 2,
    elevation: 2,
  },
  content: {
    flex: 1,
  },
  header: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 8,
  },
  patientName: {
    fontSize: 16,
    fontWeight: 'bold',
    flex: 1,
  },
  statusBadge: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 12,
  },
  statusText: {
    fontSize: 12,
    marginLeft: 4,
  },
  vaccineName: {
    fontSize: 14,
    color: '#212529',
    marginBottom: 8,
  },
  footer: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  dateContainer: {
    flexDirection: 'row',
    alignItems: 'center',
  },
  date: {
    fontSize: 12,
    color: '#6c757d',
    marginLeft: 4,
  },
  actions: {
    flexDirection: 'row',
    gap: 8,
    marginTop: 12,
  },
  actionButton: {
    flexDirection: 'row',
    alignItems: 'center',
    padding: 8,
    borderRadius: 6,
    minWidth: 80,
    justifyContent: 'center',
  },
  viewButton: {
    backgroundColor: '#e3f2fd',
    borderWidth: 1,
    borderColor: '#007bff',
  },
  completeButton: {
    backgroundColor: '#007bff',
  },
  actionText: {
    fontSize: 12,
    marginLeft: 4,
  },
  completeText: {
    color: '#fff',
  },
});
```

### Filter Button Component

```typescript
// frontend/app/components/FilterButton.tsx
import React from 'react';
import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
import { Ionicons } from '@expo/vector-icons';

type FilterButtonProps = {
  label: string;
  icon: string;
  isActive: boolean;
  count?: number;
  onPress: () => void;
};

export default function FilterButton({ label, icon, isActive, count, onPress }: FilterButtonProps) {
  return (
    <TouchableOpacity
      style={[styles.button, isActive && styles.activeButton]}
      onPress={onPress}
    >
      <Ionicons name={icon as any} size={16} color={isActive ? '#fff' : '#6c757d'} />
      <Text style={[styles.label, isActive && styles.activeLabel]}>{label}</Text>
      {count !== undefined && (
        <View style={[styles.count, isActive && styles.activeCount]}>
          <Text style={[styles.countText, isActive && styles.activeCountText]}>{count}</Text>
        </View>
      )}
    </TouchableOpacity>
  );
}

const styles = StyleSheet.create({
  button: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingHorizontal: 16,
    paddingVertical: 8,
    marginRight: 8,
    borderRadius: 20,
    backgroundColor: '#f8f9fa',
    borderWidth: 1,
    borderColor: '#e9ecef',
  },
  activeButton: {
    backgroundColor: '#007bff',
    borderColor: '#007bff',
  },
  label: {
    fontSize: 14,
    color: '#6c757d',
    marginLeft: 6,
  },
  activeLabel: {
    color: '#fff',
  },
  count: {
    marginLeft: 6,
    backgroundColor: '#e9ecef',
    borderRadius: 10,
    paddingHorizontal: 6,
    paddingVertical: 2,
  },
  activeCount: {
    backgroundColor: '#fff',
  },
  countText: {
    fontSize: 12,
    color: '#6c757d',
    fontWeight: 'bold',
  },
  activeCountText: {
    color: '#007bff',
  },
});
```

### API Service Updates

```typescript
// Add to frontend/services/api.ts
// Notifications endpoints
getNotifications: (params?: { page?: number; limit?: number; status?: string }) => 
  api.get('/notifications', { params }),
getNotification: (id: number) => api.get(`/notifications/${id}`),
updateNotificationStatus: (id: number, status: string) => 
  api.put(`/notifications/${id}`, { status }),
getDueNotifications: () => api.get('/notifications/due'),
```

## Directory Structure

```
frontend/app/notifications/
├── _layout.tsx           # Navigation layout
├── index.tsx            # Notifications list screen
└── [id].tsx            # Notification details screen
```

## Expected Outcome
- Complete notifications management system with dedicated screens
- Seamless integration with dashboard navigation
- Full CRUD operations for notification status management
- Responsive design optimized for mobile devices
- Proper error handling and loading states

## Testing Guidelines

1. **Navigation Testing**: Verify navigation from dashboard to notifications
2. **Data Loading**: Test notification loading and pagination
3. **Status Updates**: Test marking notifications as viewed/completed
4. **Error Handling**: Test network errors and empty states
5. **Responsive Design**: Test on various screen sizes

## Integration Steps

1. Create the notifications directory structure
2. Implement the layout and navigation
3. Build the list and detail screens
4. Add API integration
5. Test the complete flow from dashboard to notifications

## Next Steps After Implementation

1. Update dashboard to use new notifications screen
2. Add push notifications support (future enhancement)
3. Implement notification badges and counts
4. Add notification preferences in settings
