{
  "version": "2.0",
  "description": "Enhanced security rules and permissions framework for BE-AW-10 implementation",
  "lastUpdated": "2025-08-26T10:52:00Z",
  
  "roles": {
    "administrator": {
      "description": "System administrators with full cross-facility access",
      "permissions": [
        "users.*",
        "databases.*",
        "storage.*",
        "functions.*",
        "teams.*"
      ],
      "specialPermissions": [
        "cross_facility_access",
        "system_configuration",
        "audit_access",
        "data_export",
        "user_management"
      ]
    },
    "supervisor": {
      "description": "Facility supervisors with administrative access to their facility",
      "permissions": [
        "databases.main.collections.patients.documents.read",
        "databases.main.collections.patients.documents.create",
        "databases.main.collections.patients.documents.update",
        "databases.main.collections.immunization_records.documents.*",
        "databases.main.collections.vaccines.documents.read",
        "databases.main.collections.facilities.documents.read",
        "databases.main.collections.facilities.documents.update",
        "databases.main.collections.notifications.documents.*",
        "databases.main.collections.vaccine_schedules.documents.read",
        "databases.main.collections.vaccine_schedules.documents.update",
        "databases.main.collections.vaccine_schedule_items.documents.read",
        "databases.main.collections.vaccine_schedule_items.documents.update",
        "databases.main.collections.supplementary_immunizations.documents.*",
        "storage.patient-documents.files.*",
        "storage.reports.files.*"
      ],
      "specialPermissions": [
        "facility_user_management",
        "facility_reports",
        "team_management",
        "facility_configuration"
      ]
    },
    "doctor": {
      "description": "Medical doctors with clinical access to patient data",
      "permissions": [
        "databases.main.collections.patients.documents.read",
        "databases.main.collections.patients.documents.create",
        "databases.main.collections.patients.documents.update",
        "databases.main.collections.immunization_records.documents.*",
        "databases.main.collections.vaccines.documents.read",
        "databases.main.collections.facilities.documents.read",
        "databases.main.collections.notifications.documents.read",
        "databases.main.collections.notifications.documents.update",
        "databases.main.collections.vaccine_schedules.documents.read",
        "databases.main.collections.vaccine_schedule_items.documents.read",
        "databases.main.collections.supplementary_immunizations.documents.*",
        "storage.patient-documents.files.*",
        "storage.reports.files.read"
      ],
      "specialPermissions": [
        "patient_care",
        "immunization_management",
        "clinical_reports",
        "medical_history_access"
      ]
    },
    "user": {
      "description": "Regular healthcare workers and data entry personnel",
      "permissions": [
        "databases.main.collections.patients.documents.read",
        "databases.main.collections.patients.documents.create",
        "databases.main.collections.patients.documents.update",
        "databases.main.collections.immunization_records.documents.read",
        "databases.main.collections.immunization_records.documents.create",
        "databases.main.collections.vaccines.documents.read",
        "databases.main.collections.facilities.documents.read",
        "databases.main.collections.notifications.documents.read",
        "databases.main.collections.vaccine_schedules.documents.read",
        "databases.main.collections.vaccine_schedule_items.documents.read",
        "databases.main.collections.supplementary_immunizations.documents.read",
        "storage.patient-documents.files.read",
        "storage.patient-documents.files.create",
        "storage.reports.files.read"
      ],
      "specialPermissions": [
        "data_entry",
        "basic_reports",
        "patient_registration"
      ]
    },
    "system": {
      "description": "System functions and automated processes",
      "permissions": [
        "databases.*",
        "storage.*",
        "functions.execute",
        "users.read"
      ],
      "specialPermissions": [
        "automated_processing",
        "system_integration"
      ]
    }
  },
  "collections": {
    "patients": {
      "documentSecurity": true,
      "facilityScoped": true,
      "permissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "create": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "update": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "documentPermissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "update": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "fieldLevelSecurity": {
        "medical_history": {
          "read": ["role:administrator", "role:supervisor", "role:doctor"],
          "write": ["role:administrator", "role:supervisor", "role:doctor"]
        },
        "contact_info": {
          "read": ["role:administrator", "role:supervisor", "role:doctor", "role:user"],
          "write": ["role:administrator", "role:supervisor", "role:doctor", "role:user"]
        },
        "guardian_info": {
          "read": ["role:administrator", "role:supervisor", "role:doctor", "role:user"],
          "write": ["role:administrator", "role:supervisor", "role:doctor", "role:user"]
        },
        "emergency_contact": {
          "read": ["role:administrator", "role:supervisor", "role:doctor"],
          "write": ["role:administrator", "role:supervisor", "role:doctor"]
        }
      },
      "securityRules": {
        "facilityIsolation": true,
        "auditRequired": true,
        "encryptionRequired": true,
        "dataClassification": "sensitive"
      }
    },
    
    "immunization_records": {
      "documentSecurity": true,
      "facilityScoped": true,
      "permissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "create": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "update": [
          "role:administrator",
          "role:supervisor",
          "role:doctor"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "documentPermissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "update": [
          "role:administrator",
          "role:supervisor",
          "role:doctor"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "auditRequired": true,
      "immutableFields": [
        "patient_id",
        "vaccine_id",
        "administered_date",
        "administered_by",
        "batch_number",
        "lot_number"
      ],
      "securityRules": {
        "facilityIsolation": true,
        "auditRequired": true,
        "encryptionRequired": true,
        "dataClassification": "sensitive",
        "retentionPolicy": "permanent"
      }
    },
    
    "notifications": {
      "documentSecurity": true,
      "facilityScoped": true,
      "permissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "create": [
          "role:administrator",
          "role:supervisor",
          "role:system"
        ],
        "update": [
          "role:administrator",
          "role:supervisor",
          "role:doctor"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "documentPermissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "update": [
          "role:administrator",
          "role:supervisor",
          "role:doctor"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "securityRules": {
        "facilityIsolation": true,
        "auditRequired": false,
        "encryptionRequired": false,
        "dataClassification": "internal",
        "retentionPolicy": "1_year"
      }
    },
    
    "facilities": {
      "documentSecurity": true,
      "facilityScoped": false,
      "permissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "create": [
          "role:administrator"
        ],
        "update": [
          "role:administrator",
          "role:supervisor"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "documentPermissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "update": [
          "role:administrator",
          "role:supervisor"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "securityRules": {
        "facilityIsolation": false,
        "auditRequired": true,
        "encryptionRequired": false,
        "dataClassification": "internal",
        "retentionPolicy": "permanent"
      }
    },
    
    "vaccines": {
      "documentSecurity": false,
      "facilityScoped": false,
      "permissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "create": [
          "role:administrator"
        ],
        "update": [
          "role:administrator"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "securityRules": {
        "facilityIsolation": false,
        "auditRequired": false,
        "encryptionRequired": false,
        "dataClassification": "public",
        "retentionPolicy": "permanent"
      }
    },
    
    "vaccine_schedules": {
      "documentSecurity": false,
      "facilityScoped": false,
      "permissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "create": [
          "role:administrator"
        ],
        "update": [
          "role:administrator",
          "role:supervisor"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "securityRules": {
        "facilityIsolation": false,
        "auditRequired": false,
        "encryptionRequired": false,
        "dataClassification": "public",
        "retentionPolicy": "permanent"
      }
    },
    
    "vaccine_schedule_items": {
      "documentSecurity": false,
      "facilityScoped": false,
      "permissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "create": [
          "role:administrator"
        ],
        "update": [
          "role:administrator",
          "role:supervisor"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "securityRules": {
        "facilityIsolation": false,
        "auditRequired": false,
        "encryptionRequired": false,
        "dataClassification": "public",
        "retentionPolicy": "permanent"
      }
    },
    
    "supplementary_immunizations": {
      "documentSecurity": true,
      "facilityScoped": true,
      "permissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "create": [
          "role:administrator",
          "role:supervisor",
          "role:doctor"
        ],
        "update": [
          "role:administrator",
          "role:supervisor",
          "role:doctor"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "documentPermissions": {
        "read": [
          "role:administrator",
          "role:supervisor",
          "role:doctor",
          "role:user"
        ],
        "update": [
          "role:administrator",
          "role:supervisor",
          "role:doctor"
        ],
        "delete": [
          "role:administrator"
        ]
      },
      "securityRules": {
        "facilityIsolation": true,
        "auditRequired": true,
        "encryptionRequired": true,
        "dataClassification": "sensitive",
        "retentionPolicy": "permanent"
      }
    }
  },
  "storage": {
    "patient-documents": {
      "permissions": {
        "read": [
          "role:admin",
          "role:healthcare_worker"
        ],
        "create": [
          "role:admin",
          "role:healthcare_worker"
        ],
        "update": [
          "role:admin",
          "role:healthcare_worker"
        ],
        "delete": [
          "role:admin"
        ]
      },
      "fileSecurity": true,
      "encryptionRequired": true,
      "antivirusRequired": true,
      "maxFileSize": 10485760,
      "allowedExtensions": ["pdf", "jpg", "jpeg", "png", "doc", "docx"]
    },
    "reports": {
      "permissions": {
        "read": [
          "role:admin",
          "role:healthcare_worker",
          "role:facility_manager",
          "role:read_only"
        ],
        "create": [
          "role:admin",
          "role:system"
        ],
        "update": [
          "role:admin"
        ],
        "delete": [
          "role:admin"
        ]
      },
      "fileSecurity": true,
      "encryptionRequired": true,
      "maxFileSize": 52428800,
      "allowedExtensions": ["pdf", "xlsx", "csv"]
    }
  },
  "functions": {
    "notifications": {
      "execute": [
        "role:admin",
        "role:system"
      ],
      "rateLimit": {
        "requests": 100,
        "duration": 3600
      }
    },
    "reports": {
      "execute": [
        "role:admin",
        "role:healthcare_worker",
        "role:facility_manager",
        "role:system"
      ],
      "rateLimit": {
        "requests": 10,
        "duration": 3600
      }
    },
    "data-sync": {
      "execute": [
        "role:admin",
        "role:system"
      ],
      "rateLimit": {
        "requests": 5,
        "duration": 3600
      }
    }
  },
  "authentication": {
    "providers": {
      "email": {
        "enabled": true,
        "passwordPolicy": {
          "minLength": 8,
          "requireUppercase": true,
          "requireLowercase": true,
          "requireNumbers": true,
          "requireSpecialChars": true,
          "preventCommonPasswords": true,
          "preventPersonalInfo": true
        },
        "accountLocking": {
          "enabled": true,
          "maxAttempts": 5,
          "lockoutDuration": 1800
        }
      },
      "phone": {
        "enabled": false
      },
      "oauth": {
        "enabled": false
      }
    },
    "sessions": {
      "maxSessions": 10,
      "sessionTimeout": 86400,
      "requireReauth": true,
      "reauthTimeout": 3600
    },
    "mfa": {
      "enabled": false,
      "required": false,
      "methods": ["totp", "email"]
    }
  },
  "rateLimiting": {
    "global": {
      "requests": 1000,
      "duration": 3600
    },
    "authentication": {
      "requests": 10,
      "duration": 900
    },
    "api": {
      "requests": 500,
      "duration": 3600
    }
  },
  "cors": {
    "origins": [
      "http://localhost:3000",
      "http://localhost:8081",
      "https://immuneme.app",
      "https://admin.immuneme.app"
    ],
    "methods": ["GET", "POST", "PUT", "DELETE", "PATCH"],
    "headers": [
      "Content-Type",
      "Authorization",
      "X-Appwrite-Project",
      "X-Appwrite-Key"
    ],
    "credentials": true
  },
  "audit": {
    "enabled": true,
    "events": [
      "account.sessions.create",
      "account.sessions.delete",
      "databases.*.collections.*.documents.create",
      "databases.*.collections.*.documents.update",
      "databases.*.collections.*.documents.delete",
      "storage.*.files.create",
      "storage.*.files.delete",
      "users.create",
      "users.update",
      "users.delete"
    ],
    "retention": {
      "days": 2555
    }
  },
  "compliance": {
    "hipaa": {
      "enabled": true,
      "dataEncryption": true,
      "accessLogging": true,
      "dataMinimization": true,
      "rightToErasure": true
    },
    "gdpr": {
      "enabled": true,
      "consentRequired": true,
      "dataPortability": true,
      "rightToErasure": true
    }
  },
  "dataIsolation": {
    "facilityBased": true,
    "rules": [
      {
        "collection": "patients",
        "field": "facility_id",
        "isolationType": "strict"
      },
      {
        "collection": "immunization_records",
        "field": "facility_id",
        "isolationType": "strict"
      },
      {
        "collection": "notifications",
        "field": "facility_id",
        "isolationType": "flexible"
      }
    ]
  }
}