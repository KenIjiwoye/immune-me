FROM node:22.16.0-alpine3.22

# Install PostgreSQL client for health checks
RUN apk add --no-cache postgresql-client

# Install development dependencies
WORKDIR /app

# Copy package files
COPY package.json package-lock.json ./

# Install all dependencies including dev dependencies
RUN npm ci --include=dev

# Copy the rest of the application
COPY . .

# Copy entrypoint script
COPY docker-entrypoint.dev.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint.dev.sh

# Expose the port
EXPOSE 3333

# Set development environment
ENV NODE_ENV=development

# Use entrypoint script
ENTRYPOINT ["docker-entrypoint.dev.sh"]
